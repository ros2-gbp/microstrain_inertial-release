microstrain_inertial_driver:
  ros__parameters:
    port         : "/dev/ttyACM0"
    baudrate     : 115200

    # ****************************************************************** 
    # Frame ID Settings 
    # ****************************************************************** 

    # The mode in which we will publish transforms to the below frame IDs
    #     0 - No transforms will be published between any of the non static frame ids. (if publish_mount_to_frame_id_transform is true, it will still be published, and so will the antenna and odometer transforms)
    #     1 - Global mode:
    #             Transform will be published from earth_frame_id to target_frame_id containing global position
    #     2 - Relative mode:
    #             Note: In order to use relative mode, you must configure filter_relative_position
    #             Transform will be published from earth_frame_id to map_frame_id using relative position configuration
    #             Transform between map_frame_id and target_frame_id will be published using position information reported by the device
    # for more information, see: https://wiki.ros.org/microstrain_inertial_driver/transforms
    tf_mode : 2

    # Frame ID that most header.frame_id fields will be populated with.
    frame_id: "cv7_ins_link"

    # Frame IDs determining the transforms published by this node to aid in navigation. See https://www.ros.org/reps/rep-0105.html
    # Note: If use_enu_frame is false, these frames (with the exception of earth_frame_id) will automatically have "_ned" appended to them.
    mount_frame_id     : "base_link"  # Frame ID that the device is mounted on.
    map_frame_id       : "map_ned"
    earth_frame_id     : "earth"
    gnss1_frame_id     : "gnss_antenna_link"
    odometer_frame_id  : "odometer_link"

    # Target frame ID to publish transform to. Note that there needs to be some path of transforms between this and frame_id
    #     If tf_mode is set to 1, a transform between earth_frame_id and target_frame_id will be published
    #     If tf_mode is set to 2, a transform between map_frame_id and target_frame_id will be published
    target_frame_id : "base_link"

    # Static transform between mount_frame_id and frame_id.
    # Note: It is recommended to define this in a urdf file if you are building a robot, or are able to modify the robot's description.
    publish_mount_to_frame_id_transform  : False
    mount_to_frame_id_transform          : [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0] # [ x, y, z, qi, qj, qk, qw ]

    # Controls if the driver outputs data with-respect-to ENU frame
    #     false - position, velocity, and orientation are WRT the NED frame (native device frame)
    #     true  - position, velocity, and orientation are WRT the ENU frame
    #
    # Note: It is strongly recommended to leave this as True if you plan to integrate with other ROS tools
    # Note: If this is set to false, all "*_frame_id" variables will have "_ned" appended to them by the driver.
    # For more information, see: https://wiki.ros.org/microstrain_inertial_driver/use_enu_frame
    use_enu_frame : False

    # ****************************************************************** 
    # Kalman Filter Settings (only applicable for devices with a Kalman Filter) 
    # ****************************************************************** 

    # (GQ7/CV7 only) Aiding measurement control 
    filter_enable_gnss_pos_vel_aiding     : True
    filter_enable_gnss_heading_aiding     : True
    filter_enable_altimeter_aiding        : True
    filter_enable_odometer_aiding         : True
    filter_enable_magnetometer_aiding     : False
    filter_enable_external_heading_aiding : True

    # (CV7-INS only) External aiding measurement configuration
    subscribe_ext_time        : False
    subscribe_ext_fix         : False
    subscribe_ext_vel_ned     : True
    subscribe_ext_vel_enu     : False
    subscribe_ext_vel_ecef    : False
    subscribe_ext_vel_body    : False
    subscribe_ext_heading_ned : True
    subscribe_ext_heading_enu : False
    subscribe_ext_mag         : False
    subscribe_ext_pressure    : False

    # (GQ7/CV7 only) PPS Source
    #     PPS Source =
    #         0 - Disabled
    #         1 - Reciever 1 (default)
    #         2 - Reciever 2
    #         3 - GPIO (provided by external source if supported). Use the GPIO config above to further configure
    #         4 - Generated from system oscillator
    filter_pps_source : 0

    # Controls if the Kalman filter will auto-init or requires manual initialization
    filter_auto_init : True

    # Controls if the Kalman filter is reset after the settings are configured
    filter_reset_after_config : True

    # We will use auto relative position configuration for this example. This configuration does a couple things:
    #   We will setup a local tangent plane at the first location we receive after the device enters full navigation mode
    #   We will publish this location as the transform from the earth_frame_id to map_frame_id frame
    filter_relative_position_config : True
    filter_relative_position_source : 2

    # 8 = use external aiding
    filter_auto_heading_alignment_selector : 8

    # (All, except -10, and -15 products) Declination Source 1 = None, 2 = magnetic model, 3 = manual 
    # Note: When using a CV7, this MUST be changed to either 1, or 3 or the node will not start
    filter_declination_source : 1
    filter_declination        : 0.23

    # Controls what kind of linear acceleration data is used in the Filter IMU message.
    #     If this is set to true, the acceleration will not factor out gravity, if set to false gravity will be filtered out of the linear acceleration.
    filter_use_compensated_accel : True

    # (GQ7/CV7 full support, GX5-45 limited support) Adaptive filter settings
    #     Adaptive level: 0 - off, 1 - Conservative, 2 = Moderate (default), 3 = agressive
    #     Time limit: Max duration of measurement rejection prior to recovery, in milliseconds - default = 15000 
    filter_adaptive_level         : 2
    filter_adaptive_time_limit_ms : 15000

    # ****************************************************************** 
    # IMU Settings 
    # ****************************************************************** 

    # Static IMU message covariance values (the device does not generate these) 
    imu_orientation_cov   : [0.01, 0., 0., 0., 0.01, 0., 0., 0., 0.01]
    imu_linear_cov        : [0.01, 0., 0., 0., 0.01, 0., 0., 0., 0.01]
    imu_angular_cov       : [0.01, 0., 0., 0., 0.01, 0., 0., 0., 0.01]
    imu_mag_cov           : [0.01, 0., 0., 0., 0.01, 0., 0., 0., 0.01]
    imu_pressure_variance : 0.01


    gpio_config    : True

    gpio3_feature  : 1
    gpio3_behavior : 2
    gpio3_pin_mode : 0

    # ****************************************************************** 
    # Publisher Settings
    # ****************************************************************** 
    #
    #  Note: If set to 0, the data will not be stremaed from the device, and the publisher will not be created

    # The speed at which the individual IMU publishers will publish at.
    imu_data_rate             : 100  # Rate of imu/data topic
    imu_mag_data_rate         : 0    # Rate of imu/mag topic
    imu_pressure_data_rate    : 10   # Rate of imu/pressure topic
    imu_wheel_speed_data_rate : 0    # Rate of imu/wheel_Speed topic

    # The speed at which the individual Filter publishers will publish at.
    filter_human_readable_status_data_rate : 1  # Rate of ekf/status
    filter_imu_data_rate                   : -1  # Rate of ekf/imu/data topic
                                                # Note: Both filter_odometry_earth_data_rate and filter_odometry_map_data_rate depend on the contents of this message.
                                                #       If either are set to a higher value, this message will be published at that rate.
    filter_llh_position_data_rate          : 10 # Rate of ekf/llh_position topic
    filter_velocity_data_rate              : 0 # Rate of ekf/velocity topic
                                                # Note: filter_odometry_map_data_rate depends on the contents of this message.
                                                #       If either are set to a higher value, this message will be published at that rate.
    filter_velocity_ecef_data_rate         : 0  # Rate of ekf/velocity_ecef topic
                                                # Note: filter_odometry_earth_data_rate depends on the contents of this message.
                                                #       If either are set to a higher value, this message will be published at that rate.
    filter_odometry_earth_data_rate        : 0 # Rate of ekf/odometry_earth topic
    filter_odometry_map_data_rate          : 0 # Rate of ekf/odometry_map topic

    # Event Configuration (CV7, GV7, CV7-INS, GV7-INS only)
    events_config: true
    events_config_file: "/home/microstrain/catkin_ws/src/cv7_events.yml"
